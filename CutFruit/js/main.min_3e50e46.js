var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(e){o(e)}}function s(t){try{c(r["throw"](t))}catch(e){o(e)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}c((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},DBFactory=function(){function t(){this.baseFactory=new dragonBones.EgretFactory,this.armatureList=[],this.nameHash={}}return t.prototype.pushDBtoFactory=function(t){var e=RES.getRes(t+"_ske_json"),n=RES.getRes(t+"_tex_json"),r=RES.getRes(t+"_tex_png");this.baseFactory.parseDragonBonesData(e),this.baseFactory.parseTextureAtlasData(n,r)},t.prototype.createArmature=function(t){this.nameHash[t]||(this.nameHash[t]=1,this.pushDBtoFactory(t));var e=this.baseFactory.buildArmature(t),n=this.getArmatureInPool();return n.initData(e,this.baseFactory),n},t.prototype.releaseArmature=function(t){t&&(t.dispose(this.baseFactory),this.armatureList.push(t))},t.prototype.getArmatureInPool=function(){return this.armatureList.length>0?this.armatureList.pop():new Armature},t}();__reflect(DBFactory.prototype,"DBFactory");var Armature=function(){function t(){}return t.prototype.play=function(t,e,n){void 0===n&&(n=1),this._armature.animation.play(t,e).timeScale=n},t.prototype.gotoAndPlayByFrame=function(t,e,n){this._armature.animation.gotoAndPlayByFrame(t,e,n)},t.prototype.goToAndStopFrame=function(t,e){void 0===e&&(e=0),this._armature.animation.gotoAndStopByFrame(t,e)},Object.defineProperty(t.prototype,"display",{get:function(){return this._armature.display},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"eventDispatcher",{get:function(){return this._armature.eventDispatcher},enumerable:!0,configurable:!0}),t.prototype.initData=function(t,e){this._armature=t,e.clock.add(this._armature)},Object.defineProperty(t.prototype,"armatureName",{get:function(){return this._armature.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),t.prototype.addAnimationCompleteListener=function(t){var e=this,n=function(){e._armature.eventDispatcher.removeDBEventListener(dragonBones.EventObject.COMPLETE,n,e),t()};this._armature.eventDispatcher.hasDBEventListener(dragonBones.EventObject.COMPLETE)||this._armature.eventDispatcher.addDBEventListener(dragonBones.EventObject.COMPLETE,n,this)},t.prototype.getSlot=function(t){return this._armature.getSlot(t)},t.prototype.dispose=function(t){t.clock.remove(this._armature),this._armature.dispose()},t}();__reflect(Armature.prototype,"Armature");var RankPart=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(RankPart.prototype,"RankPart",["eui.UIComponent","egret.DisplayObject"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[4,platform.login()];case 2:return t.sent(),platform.getUserInfo().then(function(t){console.log("成功",t.userInfo,"isFrist:"+t.isFrist)})["catch"](function(t){console.log("失败",t)}),platform.wxInit().then(function(){console.log("wxInit 成功")}),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("loading")];case 2:return n.sent(),t=new LoadingUI,this.stage.addChild(t),[4,this.loadTheme()];case 3:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 4:return n.sent(),this.stage.removeChild(t),[3,6];case 5:return e=n.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){SenceManager.getInstance().setStage(this),SenceManager.getInstance().addSence(SenceManager.getInstance().startGameSence)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.shareAppMessage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.wxInit=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.vibrateShort=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.showModal=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,r){function i(t){e.call(r,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(r))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(r,generateJSON.paths[t])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function r(r){e.call(n,r,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?r(i):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoopDB=function(){function t(t){this.dbArmature=t}return t.prototype.checkAnimName=function(t){return this.dbArmature.animation.animationNames.indexOf(t)>-1?!0:(console.log(this.dbArmature.armatureName+"没有"+t+"动画"),!1)},t.prototype.playByPromise=function(t,e){var n=this;return this.dbArmature.play(e,0),t.then(function(){var t=function(){n.dbArmature.eventDispatcher.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,t,n),console.log("播放完当前循环动画")};n.dbArmature.eventDispatcher.addDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,t,n),console.log("promise 成功完成")})},t}();__reflect(LoopDB.prototype,"LoopDB");var DiyButton=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.click,this)},e.prototype.click=function(){if("default"==this.currentState){var t=this.parent;t.lottery()}},e}(eui.Component);__reflect(DiyButton.prototype,"DiyButton",["eui.UIComponent","egret.DisplayObject"]),window.DiyButton=DiyButton;var FreeButton=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Button);__reflect(FreeButton.prototype,"FreeButton",["eui.UIComponent","egret.DisplayObject"]);var Fruit=function(t){function e(e){var n=t.call(this)||this;return n.data=e,n}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.id=this.data.id,this.icon=this.data.icon,this.left=this.data.left,this.right=this.data.right,this.fxname=this.data.fxname,this.juiceimg=this.data.juiceimg,this.img.texture=RES.getRes(this.icon)},e}(eui.Component);__reflect(Fruit.prototype,"Fruit",["eui.UIComponent","egret.DisplayObject"]);var FruitShop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(FruitShop.prototype,"FruitShop",["eui.UIComponent","egret.DisplayObject"]);var ObjectPool=function(){function t(){}return t.dbFactory=new DBFactory,t}();__reflect(ObjectPool.prototype,"ObjectPool");var GameSence=function(t){function e(){var e=t.call(this)||this;return e.currentLevelId=1,e.currentChirldLevelId=-1,e.childIndex=0,e.ro=0,e.isready=!0,e.juiceCount=0,e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){var t=this;this.addButtonsEvent(),this.getdata(),this.initdbGroup(),this.addEventListener(egret.Event.ADDED,function(){SenceManager.getInstance().weaponList.currentImg?t.weapon.texture=SenceManager.getInstance().weaponList.currentImg.texture:t.weapon.texture=SenceManager.getInstance().startGameSence.weapon.texture},this),this.weapon.anchorOffsetX=this.weapon.width/2,this.weapon.anchorOffsetY=this.weapon.height/2,this.weaponY=this.weapon.y,this.wpDefault(),this.currentChirldLevelId=this._levels[this.currentLevelId-1].chirldLevel[0],this.loadFruitsGroup(this.currentChirldLevelId),this.updateUI(),this.addEventListener(egret.TouchEvent.TOUCH_END,this.throwOnClick,this)},e.prototype.addButtonsEvent=function(){var t=this;this.tulongbaodao.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){platform.shareAppMessage()},this),this.threeWeapons.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this),this.changeWeapon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().switchSence(SenceManager.getInstance().weaponList,t)},this)},e.prototype.getdata=function(){this._levels=JsonData.getInstance().getJsonData("Levels_json"),this._levelData=JsonData.getInstance().getJsonData("LevelData_json"),this._fruitArray=JsonData.getInstance().getJsonData("FruitArray_json"),this._posArray=JsonData.getInstance().getJsonData("PosArray_json"),this._position=JsonData.getInstance().getJsonData("Position_json"),this._actArray=JsonData.getInstance().getJsonData("ActArray_json"),this._action=JsonData.getInstance().getJsonData("Action_json"),this._fruits=JsonData.getInstance().getJsonData("fruits_json")},e.prototype.initdbGroup=function(){this.dbGroup=new eui.Group,this.dbGroup.touchEnabled=!1,this.addChild(this.dbGroup),this.dbGroup.width=this.stage.width,this.dbGroup.height=this.stage.height},e.prototype.wpDefault=function(){this.weapon.y=this.weaponY,this.weapon.rotation=0,this.removeEventListener(egret.Event.ENTER_FRAME,this.eliminate,this);var t=egret.Tween.get(this.weapon,{loop:!0});t.to({y:this.weaponY-this.weapon.height/3},500).to({y:this.weaponY},500)},e.prototype.throwOnClick=function(t){var e=this.istarget(t);console.log(e),this.isready&&!e&&this.throwWeapon()},e.prototype.istarget=function(t){return t.target==this.changeWeapon||t.target==this.threeWeapons||t.target==this.tulongbaodao},e.prototype.loadLevel=function(t){return this._levels[t-1]},e.prototype.loadFruitsGroup=function(t){this.fruitsGroup.removeChildren(),this.dbGroup.removeChildren();var e=this._levelData[t-1];this.setGroupPos(),this.fillFuruitGroup(e),this.isready=!0},e.prototype.fillFuruitGroup=function(t){for(var e=this._fruitArray[t.fruitArrayId-1],n=this._posArray[t.posArrayId-1].posArray,r=0;r<e.count;r++){var i=e.fruitArray[0],o=this._position[n[r]-1];this.createFruit(i,o)}this.addaction(t.actArrayId),console.log("当前实例化的是第 "+this._levels[this.currentLevelId-1].id+" 大关, \n		小关id: "+this._levels[this.currentLevelId-1].chirldLevel[this.childIndex])},e.prototype.setGroupPos=function(){this.fruitsGroup.x=this.stage.width/2,this.fruitsGroup.y=.33*this.stage.height},e.prototype.createFruit=function(t,e){var n=new Fruit(this._fruits[t]);this.fruitsGroup.addChild(n),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=e.x,n.y=e.y},e.prototype.addaction=function(t){for(var e=this._actArray[t-1],n=[],r=0;r<e.actArray.length;r++)n.push(this._action[e.actArray[r]-1]);this.ro=this.fruitsGroup.rotation,egret.Tween.removeTweens(this.fruitsGroup),this.fruitGrouptw(n)},e.prototype.fruitGrouptw=function(t){for(var e=this,n=egret.Tween.get(this.fruitsGroup),r=function(e){i.ro+=t[e].rotation,n.to({rotation:i.ro},1e3*t[e].time).call(function(){console.log("度数 : "+t[e].rotation)})},i=this,o=0;o<t.length;o++)r(o);n.call(function(){e.ro=e.fruitsGroup.rotation,egret.Tween.removeTweens(e.fruitsGroup),e.fruitGrouptw(t)})},e.prototype.throwWeapon=function(){var t=this;console.log("点击"),egret.Tween.removeTweens(this.weapon),this.addEventListener(egret.Event.ENTER_FRAME,this.eliminate,this);var e=egret.Tween.get(this.weapon);this.isready=!1;var n=this.fruitsGroup.numChildren;e.to({y:-200,rotation:1080},450).call(function(){n==t.fruitsGroup.numChildren?(SenceManager.getInstance().addSence(SenceManager.getInstance().resurrection),t.isready=!0):0==t.fruitsGroup.numChildren?(t.childIndex++,t.tw_Cup_out().then(function(){return t.updateUI()}).then(function(){return t.tw_Cup_in()}).then(function(){t.clearLevel()})):t.isready=!0,t.wpDefault()})},e.prototype.clearLevel=function(){var t=this;this.childIndex<this._levels[this.currentLevelId-1].chirldLevel.length?(console.log("未完成所有小关"),this.currentChirldLevelId=this._levels[this.currentLevelId-1].chirldLevel[this.childIndex],this.loadFruitsGroup(this.currentChirldLevelId)):(console.log("进入下一大关"),console.log("------------------------------------------------------------"),setTimeout(function(){t.setNextLevelData(),SenceManager.getInstance().addSence(SenceManager.getInstance().victory),SenceManager.getInstance().victory.addEventListener(egret.Event.REMOVED,t.loadNewLevel,t)},200))},e.prototype.setNextLevelData=function(){this.currentLevelId++,this.childIndex=0,this.currentChirldLevelId=this._levels[this.currentLevelId-1].chirldLevel[0]},e.prototype.loadNewLevel=function(){this.loadFruitsGroup(this.currentChirldLevelId),this.updateUI(),SenceManager.getInstance().victory.removeEventListener(egret.Event.REMOVED,this.loadNewLevel,this)},e.prototype.eliminate=function(){for(var t=0;t<this.fruitsGroup.numChildren;t++){var e=this.fruitsGroup.getChildAt(t).hitTestPoint(this.weapon.x,this.weapon.y),n=this.fruitsGroup.getChildAt(t).hitTestPoint(this.weapon.x+this.weapon.width,this.weapon.y),r=this.fruitsGroup.getChildAt(t).hitTestPoint(this.weapon.x,this.weapon.y+this.weapon.height),i=this.fruitsGroup.getChildAt(t).hitTestPoint(this.weapon.x+this.weapon.width,this.weapon.y+this.weapon.height);if(e||n||r||i){var o=this.fruitsGroup.getChildAt(t);o.visible=!1;var a=this.fruitsGroup.localToGlobal(o.x,o.y);this.db_cutFX(a,o.fxname),this.db_half(a,o.icon,o.left,o.right,o.juiceimg),this.fruitsGroup.removeChildAt(t)}}},e.prototype.updateUI=function(){var t=this,e=new Promise(function(e,n){t.levelLabel.text="第 "+t.currentLevelId+" 关";var r=t._levels[t.currentLevelId-1].chirldLevel.length,i=t.childIndex/r,o=390*i,a=egret.Tween.get(t.progress);a.to({width:o},100).call(e)});return e},e.prototype.tw_Cup_out=function(){var t=this,e=new Promise(function(e,n){var r=egret.Tween.get(t.juiceCup),i=t.juiceCup.x;r.to({},500).to({x:-i-t.juiceCup.width},200).call(function(){t.juiceGroup.removeChildren(),t.juiceCount=0,e()})});return e},e.prototype.tw_Cup_in=function(){var t=this,e=new Promise(function(e,n){var r=egret.Tween.get(t.juiceCup),i=t.juiceCup.x;r.to({x:-i-t.juiceCup.width},200).call(e)});return e},e.prototype.db_cutFX=function(t,e){var n=ObjectPool.dbFactory.createArmature("FXqieSG");n.display.x=t.x,n.display.y=t.y,this.dbGroup.addChild(n.display),n.play(e,1),n.display.addEventListener(dragonBones.EventObject.COMPLETE,function(){n.display.visible=!1},this)},e.prototype.db_half=function(t,e,n,r,i){var o=this,a=ObjectPool.dbFactory.createArmature("QieSG_anim");a.getSlot("cm").display=new egret.Bitmap(RES.getRes(e)),a.getSlot("cmb").display=new egret.Bitmap(RES.getRes(n)),a.getSlot("cmb_拷贝").display=new egret.Bitmap(RES.getRes(r)),a.display.x=t.x,a.display.y=t.y,this.dbGroup.addChild(a.display),a.play("1",1);egret.Tween.get(a.display).to({x:this.juiceCup.x+this.juiceCup.width,y:this.juiceCup.y},700).call(function(){a.display.visible=!1,o.filljuice(i)})},e.prototype.filljuice=function(t){this.juiceCount++;var e=new egret.Bitmap(RES.getRes(t));this.juiceGroup.addChild(e),e.width=55;var n=this._levelData[this.currentChirldLevelId-1].fruitArrayId,r=this.juiceCount/this._fruitArray[n-1].count;e.height=100*r,e.y=-100*r},e}(eui.Component);__reflect(GameSence.prototype,"GameSence",["eui.UIComponent","egret.DisplayObject"]);var Rank=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){var t=this;this.backToStart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().removeSence(t)},this);for(var e=[{rank:1,profilePic:"C1_png",playername:"球1",level:10},{rank:2,profilePic:"C2_png",playername:"球2",level:9},{rank:3,profilePic:"C3_png",playername:"球3",level:8},{rank:4,profilePic:"C4_png",playername:"球4",level:7},{rank:5,profilePic:"C5_png",playername:"球5",level:6},{rank:6,profilePic:"C6_png",playername:"球6",level:5},{rank:7,profilePic:"C7_png",playername:"球7",level:4},{rank:8,profilePic:"C8_png",playername:"球8",level:3},{rank:9,profilePic:"C9_png",playername:"球9",level:2},{rank:10,profilePic:"C10_png",playername:"球10",level:1}],n=0;n<e.length;n++){var r=new RankPart;this.ranklist.addChild(r),e[n].rank<4?r.rankimg.texture=RES.getRes("icon_no"+e[n].rank+"_png"):(r.rankimg.visible=!1,r.ranktext.visible=!0,r.ranktext.text=""+e[n].rank),r.profilePic.texture=RES.getRes(e[n].profilePic),r.playername.text=e[n].playername,r.level.text=""+e[n].level}},e}(eui.Component);__reflect(Rank.prototype,"Rank",["eui.UIComponent","egret.DisplayObject"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.createView,e),e}return __extends(e,t),e.prototype.createView=function(){var t=new egret.Bitmap(RES.getRes("ditu_png"));this.addChild(t),this.progressBg=new egret.Bitmap(RES.getRes("loading_xuetiao_bg01_png")),this.addChild(this.progressBg),this.progressBg.x=(this.stage.stageWidth-this.progressBg.width)/2,this.progressBg.y=(this.stage.stageHeight-this.progressBg.height)/2,this.progress=new egret.Bitmap(RES.getRes("loading_xuetiao_bg02_png")),this.addChild(this.progress),this.progress.visible=!1,this.progress.x=this.progressBg.x,this.progress.y=this.progressBg.y,this.orange=new egret.Bitmap(RES.getRes("loading_juzi_png")),this.orange.name="orange",this.addChild(this.orange),this.orange.x=this.progressBg.x,this.orange.y=this.progressBg.y,this.orange.anchorOffsetX=this.orange.width/3*2,this.orange.anchorOffsetY=this.orange.height/7*3,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=this.progressBg.y+100,this.textField.width=this.stage.stageWidth,this.textField.size=40,this.textField.textColor=11937546,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text=Math.floor(t/e*100)+"%",this.progress.visible=!0,this.progress.width=this.progressBg.width*t/e,this.orange.x=this.progressBg.x+this.progress.width,this.progress.width<35&&(this.progress.width=35)},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Resurrection=function(t){function e(){var e=t.call(this)||this;return e.shape=new egret.Shape,e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){var t=this;this.count_img.parent.addChild(this.shape),this.shape.rotation=-90,this.shape.x=this.count_img.width/2,this.shape.y=this.count_img.height/2,this.r=this.count_img.width/2,this.count_img.mask=this.shape,this.addEventListener(egret.Event.ADDED,this.startCountDown,this),this.skip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.timerReset(),SenceManager.getInstance().removeSence(t,t.parent)},this)},e.prototype.startCountDown=function(){this.timer=new egret.Timer(1e3,10),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.start()},e.prototype.timerFunc=function(){this.count_text.text=""+(10-this.timer.currentCount),this.countMask()},e.prototype.timerReset=function(){this.count_text.text="10",this.shape.graphics.clear(),this.timer.reset()},e.prototype.countMask=function(){this.shape.graphics.beginFill(16711680),this.shape.graphics.moveTo(0,0),this.shape.graphics.lineTo(this.r,this.r),this.shape.graphics.drawArc(0,0,this.r,0,this.timer.currentCount/10*360*Math.PI/180,!1),this.shape.graphics.lineTo(0,0),this.shape.graphics.endFill()},e}(eui.Component);__reflect(Resurrection.prototype,"Resurrection",["eui.UIComponent","egret.DisplayObject"]);var StartGameSence=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){var t=this;WeaponData.getInstance().getweapons(),this.startgame.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().switchSence(SenceManager.getInstance().gameSence,t)},this),this.rankbtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){platform.shareAppMessage()},this),this.changeWeapon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().switchSence(SenceManager.getInstance().weaponList,t)},this),this.tw()},e.prototype.tw=function(){var t=egret.Tween.get(this.weapon,{loop:!0});t.to({y:500},800).to({y:550},800);var e=egret.Tween.get(this.gift,{loop:!0});e.to({rotation:30},1e3).to({rotation:-30},2e3).to({rotation:0},1e3);var n,r,i,o;this.scaling(this.changeWeapon,n),this.scaling(this.getCoins,r),this.scaling(this.juiceShop,i),this.scaling(this.qiandao,o)},e.prototype.scaling=function(t,e,n,r,i){n||(n=1),r||(r=.9),i||(i=1200),e=egret.Tween.get(t,{loop:!0}),e.to({scaleX:r,scaleY:r},i).to({scaleX:n,scaleY:n},i)},e}(eui.Component);__reflect(StartGameSence.prototype,"StartGameSence",["eui.UIComponent","egret.DisplayObject"]);var Victory=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){var t=this;this.btn_backtoStart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().removeSence(),SenceManager.getInstance().addSence(SenceManager.getInstance().startGameSence)},this),this.btn_nextLevel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().removeSence(t,t.parent)},this)},e}(eui.Component);__reflect(Victory.prototype,"Victory",["eui.UIComponent","egret.DisplayObject"]);var WeaponGrid=function(t){function e(e){var n=t.call(this)||this;return n.name=e.icon,n.data=e,n}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.data.isowned?this.data.selected?(this.currentState="selected",WeaponData.getInstance().currentWeapon=this):this.currentState="owned":this.currentState="notowned"},e}(eui.Component);__reflect(WeaponGrid.prototype,"WeaponGrid",["eui.UIComponent","egret.DisplayObject"]);var WeaponGroup=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(WeaponGroup.prototype,"WeaponGroup",["eui.UIComponent","egret.DisplayObject"]);var WeaponList=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.addweapons(),this.addPageTurnListener(),this.changepage()},e.prototype.addPageTurnListener=function(){this.backTo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().removeSence(),SenceManager.getInstance().addSence(SenceManager.getInstance().lastsence)},this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.turnbegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.turning,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.turnend,this)},e.prototype.removePageTurnListener=function(){this.backTo.removeEventListener(egret.TouchEvent.TOUCH_TAP,function(){SenceManager.getInstance().removeSence(),SenceManager.getInstance().addSence(SenceManager.getInstance().lastsence)},this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.turnbegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.turning,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.turnend,this)},e.prototype.addweapons=function(){for(var t=WeaponData.getInstance().weaponarr,e=0;e<t.length;e++){var n=new eui.Group,r=new eui.TileLayout;r.requestedColumnCount=4,n.layout=r,n.name=""+e;for(var i=0;i<t[e].length;i++){var o=new WeaponGrid(t[e][i]);n.addChild(o),o.touchChildren=!1,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changestate,this)}this.weapongroups.addChild(n),this.groupWidth=n.width}this.updateCurrentWeaponImg()},e.prototype.updateCurrentWeaponImg=function(){this.currentImg.texture=RES.getRes(WeaponData.getInstance().currentWeapon.data.icon),SenceManager.getInstance().startGameSence.weapon.texture=this.currentImg.texture},e.prototype.testfunc=function(){for(var t=0;t<this.weapongroups.numChildren;t++){var e=this.weapongroups.getChildByName(""+t);e.touchChildren=!1}},e.prototype.testfunc2=function(){for(var t=0;t<this.weapongroups.numChildren;t++){var e=this.weapongroups.getChildByName(""+t);e.touchChildren=!0}},e.prototype.turnbegin=function(t){this.touchpoint=t.stageX,this.touchpoint_move=t.stageX,this.initposition=this.weapongroups.x},e.prototype.turning=function(t){var e=t.stageX-this.touchpoint_move;this.weapongroups.x+=e,this.touchpoint_move=t.stageX},e.prototype.turnend=function(t){this.removePageTurnListener();var e=t.stageX-this.touchpoint;this.weapongroups.x=this.initposition,Math.abs(e)>this.width/4&&(0>e?this.weapongroups.x>-this.weapongroups.width+this.groupWidth+150&&(this.weapongroups.x-=this.groupWidth+150,WeaponData.getInstance().pageInedx++,this.changepage()):e>0&&this.weapongroups.x<78&&(this.weapongroups.x+=this.groupWidth+150,WeaponData.getInstance().pageInedx--,this.changepage()),this.initposition=0),this.addPageTurnListener()},e.prototype.changepage=function(){this.page.removeChildren();for(var t=0;t<this.weapongroups.numChildren;t++){var e=new eui.Image;this.page.addChild(e),t==WeaponData.getInstance().pageInedx?e.texture=RES.getRes("icon_dian02_png"):e.texture=RES.getRes("icon_dian01_png"),this.pricebtn.currentState="default";var n=this.pricebtn.getChildByName("price");n.text=""+1500*(WeaponData.getInstance().pageInedx+1),3==WeaponData.getInstance().pageInedx&&(this.pricebtn.currentState="turntable")}},e.prototype.changestate=function(t){console.log(t.target);var e=t.target;e.data.isowned&&(e.data.selected||this.update_selected(e))},e.prototype.update_selected=function(t){t.data.selected=!0;var e=t.parent.getChildIndex(t),n=WeaponData.getInstance().currentWeapon;n.data.selected=!1;var r=n.parent.getChildIndex(n),i=WeaponData.getInstance().weaponarr;i[t.parent.name][e].selected=!0,i[n.parent.name][r].selected=!1,n.init(),t.init(),this.updateCurrentWeaponImg()},e.prototype.lottery=function(){var t=WeaponData.getInstance().pageInedx,e=WeaponData.getInstance().weaponarr[t],n=[];if(e.forEach(function(t,e){t.isowned||n.push(t)}),0==n.length)return void console.log("当前页没有可以抽取的武器;");this.removePageTurnListener(),this.touchChildren=!1;for(var r=5,i=[],o=0;r>o;o++){var a=Math.floor(Math.random()*n.length);i.push(n[a])}var s,c=this.weapongroups.getChildByName(""+t),p=c.getChildByName(i[r-1].icon),h=0,u=this;s=setInterval(function(){if(h<i.length){var t=c.getChildByName(i[h].icon),e=egret.Tween.get(t);e.to({scaleX:.9,scaleY:.9},200).to({scaleX:1,scaleY:1},200),h++}else clearInterval(s),i[r-1].isowned=!0,p.data.isowned=!0,u.update_selected(p),u.touchChildren=!0,u.addPageTurnListener()},400)},e}(eui.Component);__reflect(WeaponList.prototype,"WeaponList",["eui.UIComponent","egret.DisplayObject"]);var Furit=function(){function t(t,e,n,r){this.whole=t,this.left=e,this.right=n,this.pos=r
}return t}();__reflect(Furit.prototype,"Furit");var GameManager=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t),this._instance},t}();__reflect(GameManager.prototype,"GameManager");var JsonData=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t),this._instance},t.prototype.getJsonData=function(t){var e=RES.getRes(t).rows;return e},t}();__reflect(JsonData.prototype,"JsonData");var SenceManager=function(){function t(){this.startGameSence=new StartGameSence,this.gameSence=new GameSence,this.victory=new Victory,this.resurrection=new Resurrection,this.rank=new Rank,this.weaponList=new WeaponList,this.lastsence=this.startGameSence}return t.getInstance=function(){return t._instance||(t._instance=new t),this._instance},t.prototype.setStage=function(t){this.root=t},t.prototype.addSence=function(t,e){e||(e=this.root),e.addChild(t)},t.prototype.switchSence=function(t,e,n){this.lastsence=e,this.addSence(t,n),this.removeSence(e,n)},t.prototype.removeSence=function(t,e){e||(e=this.root),t?e.removeChild(t):e.removeChildren()},t.prototype.resetSence=function(t){},t}();__reflect(SenceManager.prototype,"SenceManager");var WeaponData=function(){function t(){this.weaponid=1,this.playerWeaponArr=[1,5,8,18,30],this.pageInedx=0}return t.getInstance=function(){return t._instance||(t._instance=new t),this._instance},t.prototype.getweapons=function(){var t=this;this.weaponarr={0:[],1:[],2:[],3:[],4:[],length:5};var e=RES.getRes("weaponku_json").rows;SenceManager.getInstance().startGameSence.weapon.texture=RES.getRes(e[this.weaponid-1].icon),e.forEach(function(e,n){switch(-1!=t.playerWeaponArr.indexOf(Number(e.id))?e.isowned=!0:e.isowned=!1,e.selected=!1,e.id==t.weaponid&&(e.selected=!0),e.type){case"A":t.weaponarr[0].push(e);break;case"B":t.weaponarr[1].push(e);break;case"C":t.weaponarr[2].push(e);break;case"D":t.weaponarr[3].push(e);break;case"E":t.weaponarr[4].push(e)}})},t}();__reflect(WeaponData.prototype,"WeaponData");